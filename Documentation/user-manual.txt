// Subsurface 4.0 User Manual
// ===========================
// :author: Manual authors: Jacco van Koll, Dirk Hohndel, Reinout Hoornweg, Linus Torvalds, Miika Turkia, Amit Chaudhuri, Jan Schubert, Willem Ferguson
// :revnumber: 4.0
// :revdate: December 2013
:icons:
:toc:
:toc-placement: manual
:numbered:
// :website: http://subsurface.hohndel.org

image::images/SubsurfaceBanner.png["Banner",align="center"]

[big]#USER MANUAL#

*Manual authors*: Jacco van Koll, Dirk Hohndel, Reinout Hoornweg, Linus Torvalds, Miika Turkia, Amit Chaudhuri, Jan Schubert, Willem Ferguson

[blue]#_Version 4.0,  December 2013_#


Welcome as a user of _Subsurface_, an advanced dive logging programme with extensive infrastructure to describe, organise and interpret scuba and free dives. _Subsurface_ runs on many hardware platforms and software environments. These include Linux (many distros), Mac (OS/X) and Windows (Win XP or later). The scope of this document is the use of the _Subsurface_ program. To install the software, consult the _Downloads_ page on the http://subsurface.hohndel.org/[_Subsurface_ web site]. Please discuss issues with this program by writing email to mailto:subsurface@hohndel.org[our mailing list] and report bugs at http://trac.hohndel.org[our bugtracker].  For instructions on how to build the software and (if needed) its dependencies please consult the README file included with the source code.

*Audience*: Recreational Scuba Divers, Free Divers, Tec Divers, Professional Divers

toc::[]

[[S_StartUsing]]
Start Using the Program
-----------------------

The _Subsurface_ window comprises a *Main Menu* (File Edit View Search Tools Documents Help) at the top of the window with four panels underneath:

1) The *Dive List* to the bottom left containing a list of all the dives in your dive log. One can select and highlight a dive on the dive list by clicking on it.

2) The *Dive Map* to the bottom right, showing your dive sites on a world map and centered on the site of the dive highlighted in the dive list.

3) The *Dive Info* to the top left, giving textual information on the highlighted dive in the dive list.

4) The *Dive Profile* to the top right, showing a graphical profile of the highlighted dive in the dive list.

One can drag the dividers between panels in order to change the size of any of the panels. _Subsurface_ remembers the position of the dividers: if one launches _Subsurface_, it uses the positions of the dividers when the program was executed previously.


image::images/main_window.jpg["The Main Window",align="center"]


You can determine which of the four panels you wish to see by selecting *View* option on the main menu and which gives the user several choices of display:

*All*: show all four of the above panels.

*Divelist*: Show only the Dive List. One can select and highlight a dive on the dive list by clicking on it.

*Profile*: Show only the Dive Profile of the highlighted dive in the dive list.

*Info*: Show only the Dive Notes about the highlighted dive.

*Globe*: Show only the world map, centered on the highlighted dive.

When one starts the program for the first time, it shows no information
at all. This is because the program doesn't have any dive information available. One now needs to do three things:

1) Create a new logbook in which you can store dive data.

2) Enter information in the new logbook.

3) Save your logbook.

[[S_NewLogbook]]
Creating a new logbook
----------------------
This is achieved by selecting _File -> New Logbook_ from the main menu. All existing dive data are cleared so that new information can be added. Existing dive data can be saved before a new logbook is created.

[[S_GetInformation]]
== How to obtain dive information to store in your logbook

There are several ways to obtain dive information to view:

1. Enter dive information by hand. This is typically useful if the diver did not use a dive computer and dives were recorded in a written logbook.

2. Import dive information directly from a dive computer if it is supported by _Subsurface_. The latest list of dive computers supported by _Subsurface_ can be found at: link:http://subsurface.hohndel.org/documentation/supported-dive-computers/[Supported dive computers].

3. Import dive information from another data base or file format. This is discussed in more detail below.

[[S_EnterData]]
=== Entering dive information by hand

This is usually the approach for dives without a dive computer. The basic record of information within _Subsurface_ is a dive. The most important information in a simple written dive logbook includes dive type, date, time, duration of dive, depth of dive, name of buddy and of dive master and some remarks about the dive. _Subsurface_ can store much more information than this for each dive. In order to add a dive to your dive log, select _Log -> Add Dive_ from the Main Menu. The program then shows three panels to enter information for a dive: two tabs in the *Info* panel (*Dive Notes* and *Equipment*), as well as the *profile* panel that displays a graphical profile of each dive. These panels are respectively marked [red]#A#, [red]#B# and [red]#C# in the figure below. We will now consider each of the tabs used for data entry.

image::images/AddDive1.jpg["The most important parts of the _Subsurface_ window for manual data entry",align="center"]

==== Dive Notes

This panel contains the date, time and place information for a particular dive, environmental conditions, co-divers and buddies, as well as some descriptive information. The message in a blue box at the top of the panel indicates that you are in the process of adding information about your dive. If one clicks on the *Dive Notes* tab, the following fields are visible:

image::images/AddDive2.png["The Dive Notes tab",align="center"]

The *Starttime* field contains five data items reflecting the date and the time of the dive. By clicking the down-arrow on the right of that field one can display a calendar from which you can choose the correct date. The hour and minutes values can also be edited by clicking on each of them in the text box and by overtyping the information displayed.

*Air/water temperatures*: Type in the air and water temperatures during the dive into these fields to the right of the Starttime. You do not need to type in units of temperature: Subsurface supplies these automatically, you only need type the number. (The units selected in the 'Preferences' [red]#[[URL link]]# will determine whether metric or imperial units are displayed)

*Location*: Here type in text that describes the site where you did this dive, e.g. "Tihany, Lake Balaton, Hungary".

*Coordinates*: The geographic coordinates of the dive site should be entered here. These can come from three sources:

a. You can enter the coordinates by hand if you happen to know what they are. You need to enter them as decimal degrees, e.g: N30° 13.49760' , E30° 49.30788'.

b. You can find the coordinates on the world map in the bottom right hand part of the Subsurface window. The map displays a green bar indicating "No location data - move the map and double-click to set the location". Upon a double-click at the appropriate place, the green bar disappears and the coordinates are stored (Sometimes the coordinates are not shown in the Dive Notes immediately but only appear when you save the data for your dive). [red]#[[Bug??]]#

c. You can obtain the coordinates from a helper program if your mobile phone has a GPS and you stored the coordinates of the dive site on your mobile or tablet.
[red]#[[Text needs to be inserted here after the helper software has been completed]]#

*Divemaster*: Enter the name of the divemaster during the dive.

*Buddy*: Enter the name of your buddy during the dive.

*Suit*: Enter the type of diving suit you used for the dive. Your descriptions of diving suits are remembered within a particular logbook so that a similar description during later dives will re-use your original description, should you wish this to happen.

*Rating*: Here you can provide a subjective overall rating of the dive on a 5-point scale by clicking the appropriate star on the rating scale.

*Visibility*: You can provide a rating of visibility during the dive on a 5-point scale by clicking the appropriate star.

*Tags*: You may enter tags here (separate them by commas) that describe the type of dive you performed. Examples of common tags are boat, drift, training, cave. _Subsurface_ has many built-in tags. If you start to type a tag, the program will list the tags that correspond to your typing. For instance, if you typed +cav+, then the tags *cave* and *cavern* are shown for the user to choose from.

*Notes*: Type any additional information here.

The *Save* and *Cancel* buttons are used to save all the information for the whole dive after ALL the other information has been added. Do NOT use them before also completing the *Equipment* tab as well as the *Dive Profile*. Here is an example of a completed Dive Notes panel:

image::images/CompletedDiveInfo.png["Example: A completed Dive Notes tab",align="center"]

==== Equipment

The Equipment tab allows the user to enter information about the type of cylinder and gas used, as well as the weighting for a dive. The message in a blue box at the top of the panel:

image::images/BlueEditBar.png["Blue edit bar",align="center"]

indicates that one is in the process of adding equipment information for the dive. This is a highly interactive part of _Subsurface_ and the information on cylinders and gases (entered here) determines the behaviour of the dive profile (top righthand panel).

*Cylinders*: The cylinder information is entered through a dialogue that looks like this:

image::images/CylinderDataEntry1.png["Initial cylinder dialogue",align="center"]

The + button at the top right allows one to add more cylinders for this dive. The dark dustbin icon on the left allows one to delete information for a cylinder.

Start by selecting a cylinder type. The AL80 cylinder is shown as the default cylinder type. If you wish to change this, click on the AL80. This will bring up a dropdown list, accessible through a down-arrow:

image::images/CylinderDataEntry2.png["The cylinder drop-down list button",align="center"]

Use the dropdown list to select the cylinder type you used for this dive. The *Size* of the cylinder as well as its working pressure (*WorkPress*) will automatically be shown in the dialogue.

Now you need to indicate the starting pressure and the ending pressure of the gas used during your dive. The unit of pressure (metric/imperial) corresponds to the setting you chose in the preferences [red]#[[LINK]]#.

Finally you need to type in the gas mixture that you used. If you used air, you can enter 21% or leave the field blank. If you used nitrox or trimix, specify the percentage of oxygen and the percentage of helium. Leave any inappropriate fields empty. Add information for any additional cylinders by using the + button at the top right hand. Here is an example of a complete description for a dive using two cylinders (air and EAN40):

image::images/CylinderDataEntry3.png["Example: a completed cylinder dive information table",align="center"]

*Weights*: Information about the weighting system used during a dive can be entered using a dialogue very similar to that of the cylinder information. If you click the + button on the top right of the weights dialogue, the table looks like this:

image::images/WeightsDataEntry1.png["The Weights dialogue",align="center"]

If you click on the *Type* field, a dropdown list becomes accessible through a down-arrow:

image::images/WeightsDataEntry2.png["Weights type drop-down list button",align="center"]

Use the dropdown list to select your type of weighting system. In the *Weight* field, type in the weight used during the dive. It is possible to enter information for more than one weighting system by adding an additional system using the + button on the top right hand. Weighting systems can be deleted using the dustbin icon on the left hand. Here is an example of information for a dive with two types of weights: integrated and a weight belt:

image::images/WeightsDataEntry3.png["Example: A completed weights information table",align="center"]

Do NOT select the _Save_ button before you have completed the dive profile.

==== Creating a Dive Profile

The *Dive Profile* (a graphical representation of the depth of your dive as a function of time) is indicated in the panel on the top right hand of the _Subsurface_ window. When you manually add a dive to your logbook, _Subsurface_ presents a default dive profile that one needs to modify to best represent the dive being described:

image::images/DiveProfile1.png["Initial dive profile",align="center"]

_Configuring the dive profile_: When one moves the cursor around the dive profile, its position is indicated by two red lines as shown above. The depth and time that the cursor represents are indicated, respectively on the left hand and bottom axes. The units (metric/imperial) on the axes are determined by the *preference* settings [red]#[[LINK]]#. The dive profile itself comprises several line segments demarcated by waypoints (white dots on the profile, as shown above). The default dive depth is 15m. If your dive depth was 21m then you need to drag the appropriate waypoints downwards to represent 21m. To add a waypoint, double-click on any line segment. To remove a waypoint, right-click on it and choose "Remove this point" from the context menu. You will also need to drag the waypoints to represent an accurate time duration for your dive. Below is a dive profile that represents a dive to 21m for 31 min., followed by a 3 minute safety stop at 5m.

image::images/DiveProfile2.png["Edited dive profile",align="center"]

_Specifying the gas composition:_ The gas composition used is clearly indicated along the line segments of the dive profile. This defaults to the first gas mixture specified in the *Equipment* tab, which was air in the case of the profile illustrated above. The gas mixtures of segments of the dive profile can be edited. This is performed by clicking on the gas description for a particular waypoint and selecting the appropriate choice from the context menu. Changing the gas for a waypoint affects the gas shown in the segment _to the left_ of that waypoint. Note that only the gases defined in the *Equipment* tab appear in the context menu:

image::images/DiveProfile3.png["Gas composition context menu",align="center"]

Below is the profile of a dive to 21m for 31 min. with a switch from air to EAN40 on the ascent. In this case the first cylinder in the *Equipment* tab contained air and the second cylinder contained EAN40.

image::images/DiveProfile4.png["Example: Completed dive profile",align="center"]

==== Saving the hand-entered dive information

The information entered in the *Dive Notes* tab, the *Equipment* tab as well as the *Dive Profile* can now be saved in your logbook by using the two buttons on the top right hand of the Dive Notes tab. If one clicks _Save_, the dive data are saved. If a logbook file hasn't been selected before, one can now select the file name and directory to store the logbook, otherwise it is saved in the already opened logbook. If one clicks _Cancel_, the newly entered dive data are deleted. When one exits _Subsurface_ there is a final prompt to confirm that the new data should be saved.


[[S_ImportNewDives]]
=== Importing new dive information from your Dive Computer

==== Connecting and importing data from a dive computer.

The use of dive computers allows collecting a large amount of information about each dive, e.g. a detailed record of depth, durations, rates of ascent/descent and of gas partial pressures. _Subsurface_ can capture this information and present it to you as part of the dive information. _Subsurface_ can obtain dive information from a wide range of dive computers. The latest list of supported dive computers can be found at: link:http://subsurface.hohndel.org/documentation/supported-dive-computers/[Supported dive computers].

[icon="images/icons/warning2.png"]
[WARNING]
Several dive computers consume more power when they are in their
PC-Communication mode. **This could drain your battery**. We therefore
recommend that you check if your dive computer is recharging when
connected to the USB port of a PC. For example, several Suunto and Mares dive computers do
not recharge through the USB connection. Please consult the manual of
your dive computer if you are unsure if it will recharge or drain its
batteries while connected to the USB port.

To import dive information from a dive computer to your computer with _Subsurface_, it is necessary that the two pieces of equipment must communicate. In order to set up this communication, you need to find the appropriate information to instruct _Subsurface_ where and how to import the dive information. *Appendix A* provides the technical information to help you achieve this for different operating systems and *Appendix B* has dive computer specific information.

Now it is time to hook up your dive computer to your PC:

 - Connect your interface cable to a free USB port (or setup the Infrared
	or Bluetooth connection as described later in this manual)

 - Put your dive computer into PC Communication mode.
	(You should consult the manual of your specific dive computer for your brand and type)

 - In _Subsurface_, from the main menu, select _Import -> Import From Dive Computer_. The following dialogue appears:


image::images/ImportFromDC1.png["Download dialogue 1",align="center"]

Often, dive computers retain all their dives even though these dives have been imported to _Subsurface_. However it is not necessary to import dives that have already been imported previously. For that reason _Subsurface_ only imports dives that have not been uploaded before. This is beneficial for saving the battery power of your dive computer. If, for some reason, one wishes to import ALL dives in the dive computer, one can tick the box labeled _Force download of all dives_.

 - The dialogue has two drop-down lists, *Vendor* and *Dive Computer*. On the *vendor* drop-down list select the make of your computer, e.g. Suunto, Oceanic, Uwatec, Mares. On the *Dive Computer* drop-down list, select the model name of your dive computer, e.g. D4 (Suunto), Veo200 (Oceanic), or Puck (Mares).

 - The *Device or Mount Point* dropdown list contains the USB or Bluetooth port name that _Subsurface_ needs in order to communicate with your dive computer. Select the appropriate port name. Consult *Appendix A* for technical details to find the appropriate port information for your dive computer and, in some cases, to do the correct settings to the operating system of your _Subsurface_ computer.

 -  Click the _OK_ button.

 - If there is a problem in communicating with your dive computer, an error message will be shown, similar to this text: "Unable to open /dev/ttyUSB0 Mares (Puck Pro)". In this case, consult *Appendix A* for information specific to the operating system of your _Subsurface_ computer and consult *Appendix B* for information specific to some dive computers. 

[icon="images/icons/important.png"]
[IMPORTANT]
In the case of *communication failure* then check the following:
1) Is the dive coputer still in PC-communication or Upload mode?
2) Is the battery of the dive computer fully loaded? If not then load or replace the battery.
3) Is the cable faulty? Does the cable work perfectly using other software? Has it worked before, or is this the first time you are using the cable?
4) Consult *Appendix A* and make sure you specified the correct Mount Point (see above). If your _Subsurface_ computer does not recognise the USB adaptor by showing an appropriate device name next to the Mount Point, then there is a possibility that the cable or USB adaptor is faulty. A faulty cable is the most common cause of communcation failure between dive computer and _Subsurface_ computer.


 - With communication established, watch how your data is retrieved from your dive computer!
   Depending on your make of computer and/or number of dives, this
   could take some time. Please be patient. The _Download_ dialogue shows a progress bar at the bottom of the dialogue:

image::images/ImportFromDC2.png["Download dialogue 2",align="center"]

When download of the dive information is complete, all the imported dives appear in the Dive List, sorted by date and time. Disconnect and switch off the dive computer to conserve its battery power.
If one selects a particular dive, the Dive Profile panel shows an informative graph of dive depth against time for that particular dive.

[[S_EditDiveInfo]]
==== Updating the dive information imported from your dive computer.

The information from your dive computer is not complete and one needs to add more details in order to have a more complete record of your dives. To do this, use the *Dive Notes* and the *Equipment* tabs on the top left hand of the _Subsurface_ window.

==== Dive Notes

The date and time of the dive, gas mixture and perhaps water temperature is shown as obtained from the dive computer, but one needs to add some information by hand in order for a more complete dive record. The message in a blue box at the top of the panel indicates that one is in the process of adding information about a dive. If one clicks on the *Dive Notes* tab, the following fields are visible:

image::images/AddDive2.png["The Dive Notes tab",align="center"]

The *Starttime* field contains five data items reflecting the date and the time of the dive, as supplied by the dive computer. It should therefore not be necessary to edit this, but one could make changes by clicking the down-arrow on the right of that field one can display a calendar from which you can choose the correct date. The hour and minutes values can also be edited by clicking on each of them in the text box and by overtyping the information displayed.

*Air/water temperatures*: Air and water temperatures during the dive are shown in these fields to the right of the Starttime. Many dive computers supply water temperature information and this field may therefore not require editing. If editing is required, one does not need to type in units of temperature: Subsurface supplies these automatically, only a number is required. (The units selected in the 'Preferences' [red]#[[URL link]]# will determine whether metric or imperial units are displayed)

*Location*: Here type in text that describes the site where you did this dive, e.g. "Tihany, Lake Balaton, Hungary".

*Coordinates*: The geographic coordinates of the dive site should be entered here. These can come from three sources:

a. You can enter the coordinates by hand if you happen to know what they are. You need to enter them as decimal degrees, e.g: N30° 13.49760', E30° 49.30788'.

b. You can find the coordinates on the world map in the bottom right hand part of the Subsurface window. The map displays a green bar indicating "No location data - move the map and double-click to set the location". Upon a double-click at the appropriate place, the green bar disappears and the coordinates are stored (Sometimes the coordinates are not shown in the Dive Notes immediately but only appear when you save the data for your dive). [red]#[[Bug??]]#

c. You can obtain the coordinates from a helper program if your mobile phone has a GPS and you stored the coordinates of the dive site on your mobile or tablet.
[red]#[[Text needs to be inserted here after the helper software has been completed]]#

*Divemaster*: Enter the name of the divemaster during the dive.

*Buddy*: Enter the name of your buddy during the dive.

*Suit*: Enter the type of diving suit you used for the dive. Your descriptions of diving suits are remembered within a particular logbook so that a similar description during later dives will re-use your original description, should you wish this to happen.

*Rating*: Here you can provide a subjective overall rating of the dive on a 5-point scale by clicking the appropriate star on the rating scale.

*Visibility*: You can provide a rating of visibility during the dive on a 5-point scale by clicking the appropriate star.

*Tags*: You may enter tags here (separate them by commas) that describe the type of dive you performed. Examples of common tags are boat, drift, training, cave. _Subsurface_ has many built-in tags. If you start to type a tag, the program will list the tags that correspond to your typing. For instance, if you typed +cav+, then the tags *cave* and *cavern* are shown for the user to choose from.

*Notes*: Type any additional information here.

The *Save* and *Cancel* buttons are used to save all the information for the whole dive after ALL the other information has been added. Do NOT use them before also completing the Equipment tab. Here is an example of a completed Dive Notes panel:

image::images/CompletedDiveInfo.png["Example: A completed Dive Notes tab",align="center"]

==== Equipment

The Equipment tab allows the user to enter information about the type of cylinder and gas you used, as well as the weighting for that dive. The message in a blue box at the top of the panel:

image::images/BlueEditBar.png["Blue edit bar",align="center"]

indicates that one is in the process of adding equipment information for the dive. This is a highly interactive part of _Subsurface_ and the information on cylinders and gases (entered here) determines the behaviour of the dive profile (top righthand panel).

*Cylinders*: The cylinder information is entered through a dialogue that looks like this:

image::images/CylinderDataEntry1.png["Initial cylinder dialogue",align="center"]

The + burron at the top right allows one to add more cylinders for this dive. The dark dustbin icon on the left allows one to delete information for a cylinder.

Start by selecting a cylinder type. The AL80 cylinder is shown as the default cylinder type. If you wish to change this, click on the AL80. This will bring up a dropdown list, accessible through a down-arrow:

image::images/CylinderDataEntry2.png["The cylinder drop-down list button",align="center"]

Use the dropdown list to select the cylinder type you used for this dive. The *Size* of the cylinder as well as its working pressure (*WorkPress*) will automatically be shown in the dialogue.

Now you need to indicate the starting pressure and the ending pressure of the specified gas during your dive. The unit of pressure (metric/imperial) corresponds to the setting you chose in the preferences [red]#[[LINK]]#.

Finally you need to type in the gas mixture that you used. If you used air, you can enter 21% or leave the field blank. If you used nitrox or trimix, specify the percentage of oxygen and the percentage of helium. Leave any inappropriate fields empty. Add information for any additional cylinders by using the + button at the top right hand. Here is an example of a complete description for a dive using two cylinders (air and EAN40):

image::images/CylinderDataEntry3.png["Example: a completed cylinder dive information table",align="center"]

*Weights*: Information about the weighting system used during a dive can be entered using a dialogue very similar to that of the cylinder information. If you click the + button on the top right of the weights dialogue, the table looks like this:

image::images/WeightsDataEntry1.png["The Weights dialogue",align="center"]

If you click on the *Type* field, a dropdown list becomes accessible through a down-arrow:

image::images/WeightsDataEntry2.png["Weights type drop-down list button",align="center"]

Use the dropdown list to select your type of weighting system. In the *Weight* field, type in the weight used during the dive. It is possible to enter information for more than one weighting system by adding an additional system using the + button on the top right hand. Weighting systems can be deleted using the dustbin icon on the left hand. Here is an example of information for a dive with two types of weights: integrated and a weight belt:

image::images/WeightsDataEntry3.png["Example: A completed weights information table",align="center"]

==== Saving the updated dive information

The information entered in the *Dive Notes* tab, the *Equipment* tab can be saved with all the other information of your dives in your logbook by using the two buttons on the top right hand of the *Dive Notes* tab. If one clicks _Save_, the dive data are saved. If one clicks _Cancel_, the newly entered dive data are deleted, although the dive profile obtained from the dive computer will be retained. When one exits _Subsurface_ there is a final prompt to confirm that the new data should be saved.

=== Importing dive information from other digital data sources or other data formats

[[S_ImportingAlienDiveLogs]]

Maybe you have a lot of dives logged using other dive log software. You don't have to type all information by hand into
_Subsurface_, because you can probably import your divelog. _Subsurface_ will import divelogs from a range of other dive log software, including
XML exports from DivingLog, divelogs.de and Suunto
DiveManager. Native format of JDiveLog and MacDive are imported as well.

When importing dives, _Subsurface_ tries to detect multiple records for
the same dive and merges the information as best as it can. If
there are no time zone issues (or other reasons that would cause the
beginning time of the dives to be almost simmultaneous) _Subsurface_
will not create duplicate entries.

[[S_ImportingDivesSuunto]]
==== Importing dives from *Suunto Divemanager 3 (DM3)*

Before you can start importing dives from 'Suunto Divemanager', you first
have to export the dives you want to import. _Subsurface_ does not import
directly from the 'Suunto Divemanager' log files. The following procedures
can be used for Linux and Windows.


===== Export from *Suunto Divemanager*

 - Start 'Suunto Divemanager' and log in with the name containing the logs
 - Do not start the import wizard to import dives from your computer.
 - In the navigation tree on the left side of the program-window, select your dives.
 - Within the list of dives, select the dives you would like to import later:
	* To select certain dives: hold 'ctrl' and click the dive
	* To select all dives:  Select the first dive, hold down shift and select the last dive
 - With the dives marked, use the program menu 'File -> Export'
 - The export pop-up will show
 - Within this pop-up, there is one field called Export Path.
	* Click the button browse next to the field Export Path
		** A file-manager like window pops up
		** Navigate to the directory where you want to store the Divelog.SDE file
		** Optional change the name of the file you want to save
		** Click 'Save'
	* You are back in the Export pop-up. Press the button 'Export'
 - Your dives are now exported to the file Divelogs.SDE.

===== Reading Suunto Divemanager Export in Subsurface

The file Divelogs.SDE can now be opened (or imported) in
_Subsurface_.

[[S_ImportingDivesSuuntoDM4]]
==== Importing dives from *Suunto Divemanager 4 (DM4)*

To import divelog from 'Suunto DM4', you need to locate the DM4 database
where the dives are stored. You can either look for the original
database or take a backup of the dives. Both methods are described here.

===== Locating the Suunto DM4 database

 * Start Suunto DM4
 * Select 'Help -> About'
 * Click 'Copy' after text 'Copy log folder path to clipboard'
 * Now open Windows Explorer
 * Paste the address to the path box at the top of the File Explorer
 * The database is called DM4.db

===== Backing up Suunto DM4

 * Start Suunto DM4
 * Select 'File - Create backup'
 * From the file menu select the location and name for the backup, we'll
   use DM4 in here with the default extension .bak
 * Click 'Save'
 * Your dives are now exported to the file DM4.bak

===== Reading Suunto DM4 backup in _Subsurface_

Importing the logs from DM4 does not require any special steps. You just
do the following:

 * Open the following menu 'File -> Import File(s)'
 * Browse your directories to the location where your DM4 backup is
   stored
 * Select the backup file you want to import and click 'Open'

It is also possible to do the importing from command line:

      subsurface MyDives.xml --import DM4.bak

==== Importing from Mares Dive Organiser V2.1

Mares Dive Organiser is a Windows application. The dive log is kept as a Microsoft SQL Compact Edition data base with a .SDF filename extension. The data base includes all Dive Organiser-registered divers on the particular computer and all Mares dive computers used. The safest way to obtain a copy of this data base is, within Dive Organiser, to select Database -> Backup from the main menu and to back up the data base to your desk top. This creates a zipped file DiveOrganiserxxxxx.dbf. Rename the file to DiveOrganiserxxxxx.zip. Inside the zipped directory is a file _DiveOrganiser.sdf_. Extract it from the zipped folder to your Desktop.

Then use _www.divelogs.de_ as a mechanism to extract the dive information from the file. Create a user account in divelogs.de , then select Import Logbook -> Dive Organiser from the menu on the left hand side. Follow the instructions carefully to transfer the information from the Dive Organiser data base to divelogs.de.

Then follow the instructions below to import dives from divelogs.de to _Subsurface_.


[[S_ImportingDivelogsDe]]
==== Importing dives from *divelogs.de*

Before you can start importing dives from divelogs.de, you first
have to export the dives you want to import. The exported .DLD file can
be imported to Subsurface either from command line or from GUI.

[red]#Full istructions need to be included here#

[[S_ImportingDR5]]
==== Importing dives from Heinrichs Weikamp DR5

When mounted as a USB drive the Heinrichs Weikamp DR5 saves a single UDDF file for every dive.
Mark all the dives you'd like to
import or open, _Subsurface_ is tested to work with DR5.
Note: The DR5 does not seem to store gradient factors nor deco information, so for
_Subsurface_ it is not possible to display them. Adjust the gradient
factors in the Tec Settings in _Subsurface_ to generate a deco overlay in the _Subsurface_ *Dive Profile* panel
to get deco displayed but please note that the deco calculated by _Subsurface_
will most likely differ from the one display at the DR5.


===== Export from divelogs.de

 - Login to https://en.divelogs.de using your user name and password.
 - Go to the 'Export Logbook' page
 - Choose 'DLD Export of your logbook' and save the resulting yourUserName.DLD file

===== Import divelogs.de to Subsurface

The import works similarly as importing any other divelogs. Just do the
following steps on Subsurface:

 - Open the following menu 'File - Import File(s)'
 - Browse your directories to the location where yourUserName.DLD is
 - Select the log file and click OK

After a few moments, you see your existing logs in _Subsurface_. Now you can
edit your dives like explained in the section <<S_EditDiveInfo, Updating the Dive Information>>.

The fields that are currently not imported are: weather, visibility and
boat.

It is also possible to import the .DLD data using the command line:

      subsurface MyDives.xml --import yourUserName.DLD

==== Importing dives from *MacDive*

Importing logs from MacDive is as easy as it gets. Do the following
steps in Subsurface:

 - Open the following menu _File - Import File(s)_
 - Browse your directories to the location where your MacDive logs are
   stored
 - Select the log file(s) you want to import and click 'open'
 - Click the OK button in the popup

After a few moments, you see your existing logs in _Subsurface_. Now you can
edit your dives like explained in the section <<S_EditDiveInfo, Updating the Dive Information>>.

_Subsurface_ imports all the relevant dive information
excluding the used equipment and diver name.

It is also possible to do the import from command line:

      subsurface MyDives.xml --import MacDiveDives.xml

[[S_ImportingDivinglog]]
==== Importing dives from *DivingLog 5.0*

Before you can start importing dives from _DivingLog_ you first have to
export those dives. Unfortunately DivingLog XML files give us no
indication on the preferences set on your system. So in order for
_Subsurface_ to be able to successfully import XML files from DivingLog
you first need to make sure that your copy of DivingLog is configured
to use the Metric system (you can easily change this in 'File ->
Preferences -> Units and Language' by clicking the 'Metric'
button). Then do the following:

 - Open the 'File -> Export -> XML' menu
 - Select the dives that you want to export
 - Click on the export button and select the filename
 - Rename the backup file to extension .db

This file can now be opened in _Subsurface_ (as described in the previous sections).

[[S_ImportingDivesJDiveLog]]
==== Importing dives from *JDiveLog*

JDiveLog stores its information in files with the extension of .jlb that contain all the information that has been stored except images in XML format.

By using  _File -> Import File(s)_ from the main menu one gets a popup asking
for the file name.  To import your JDiveLog file(s) do the following:

 - Open _File - Import File(s)_ on the menu
 - Browse your directories to the location where your *.jlb file is
 - Select your existing *.jlb file and click 'open'
 - Click the OK button in the popup

After a few moments, you see your existing logs in _Subsurface_. Now you can
edit your dives like explained in the section <<S_EditDiveInfo, Updating the Dive Information>>.

Information that is imported from JDiveLog into the *location* field:

 - Extended dive location information

Information that is merged into the *notes* field:

 - Used amount of weight
 - Used type of suit
 - Used type of gloves
 - Type of dive
 - Dive activity

Alternatively, you can start _Subsurface_ with the --import command line
which will have the same effect:

      subsurface MyDives.xml --import JDiveLogDives.jlb

will open your divelog (assuming that's called MyDives.xml) and then
import the dives from JdivelogDives.jlb. You can now save the combined
divelog back as MyDives.xml.


[[S_Importingkenozooid]]
==== Importing dives from *Kenozooid*

_Kenozooid_ uses UDDF to store dives and is tested to work with _Subsurface_.
Make sure you are not using compressed files when importing to _Subsurface_
 or uncompress them manually beforehand.

[[S_ImportingUDDF]]
==== Importing UDDF Dives

_Subsurface_ supports UDDF as a generic import format.
Some attributes in your file may not get processed properly.

Please report your findings for UDDF data from sources different from those descibed
in this document at http://trac.hohndel.org[our bugtracker] or send an email to
mailto:subsurface@hohndel.org[our mailing list].


[red]#Needed here: Careful check of the current accuracy of the information and detail description of import from other digital sources, divelogs.de etc.#

== Obtaining more information about dives entered into the logbook

=== The *Dive Info* tab (for individual dives)

The Dive Info tab gives some summary information about a particular dive that has been selected in the *Dive List*. Useful information here includes the surface interval before the dive, the maximum and mean depths of the dive, the gas volume consumed, the surface air consumption (SAC) and the number oxygen toxicity units (OTU) incurred.

=== The *Stats* tab (for groups of dives)

The Stats tab gives summary statistics for more than one dive, assuming that more than one dive have been selected in the *Dive List*. Select more than one dive by the standard Ctrl-click or Shift-click of the mouse. If only one dive has been selected, figures pertaining to only that dive are given. This tab shows the number of dives selected, the total amount of dive time in these dives, as well as the minimum, maximum and mean for the dive duration, dive depth, water temperature and surface air consumption (SAC).

[[S_DiveProfile]]
=== The *Dive Profile*

image::images/Profile2.png["Typical dive profile",align="left"]

Of all the panels in _Subsurface_, the Dive Profile contains the most detailed information about each dive. The main item in the Dive profile is the graph of dive depth as a function of time. In addition to the obvious information of the depth it also shows the ascent and descent rate compared to the recommended speed of going up or down in the water column. This information is given using different colors:
|====================
|*Colour*|*Descent speed (m/s)*|*Ascent speed (m/s)*
|Red|> 30|> 18
|Orange|18 - 30|9 - 18
|Yellow|9 - 18|4 - 9
|Light green|1.5 - 9|1.5 - 4
|Dark green|< 1.5|< 1.5
|=====================

The profile also includes depth readings for the peaks in the graph. Thus you should see the depth of the deepest point and other peaks. Mean depth is marked with a horizontal red line.

The *air consumption* graph displays the tank pressure and its change during the dive. The air consumption takes depth into account so that even when manually entering the start and end pressures the graph is not a straight line. Similarly to the depth graph the tank pressure gives you information about the momentary SAC rate (Surface Air Consumption – often also called RMV – Respiratory Minute Volume) when using an air integrated dive computer. Here the color coding is not relative to some absolute values but relative to the average normalized air consumption during the dive. So areas that are red or orange indicate times of increased normalized air consumption while dark green reflects times when the diver was using less gas than average. The color coding is obviously only possible when a tank sensor is connected and tank pressure readings during the dive are available.

*Water temperature* is displayed with its own blue line with degree markings placed adjacent to significant changes.

It is possible to *zoom* into the profile graph. This is done either by using the scroll wheel / scroll gesture of your mouse or trackpad  By default _Subsurface_ always shows a profile area large enough for at least 30 minutes and 30m (100ft) – this way short or shallow dives are intuitively recognizable; something that free divers clearly won’t care about.

image::images/MeasuringBar.png["FIGURE: Measuring Bar",align="left"]

Measurements of *depth differences* can be achieved by using the button with two vertical bars at the right of the dive profile panel (see above figure, bottom right). Drag the red dots to the two points on the dive profile which you would like to measure. Information is given along the line connecting the two red dots.

The dive profile can include further information that is typically more interesting for tec divers. Enabling these is described in the section entitled Setting up Preferences. Basically you can include graphs of the *partial pressures* of O2, N2, and He during the dive as well as a calculated and dive computer reported deco ceilings (only visible for deep, long, or repetitive dives). The partial pressure graphs are added below the profile data, the calculated ceiling is shown as a green overlay on top of the dive profile. Above the profile the currently used gradient factors are shown (e.g. GF 35/75). Please note that these are NOT the gradient factors in use by the dive computer in question, but the gradient factors used by _Subsurface_ to calculate deco obligations during the dive.

The graph can also include the dive computer reported *ceiling* (or more precisely, the first deco stop that the dive computer recorded – note that not all dive computers record this information and make it available for download; for example all of the Suunto dive computers fail to make this very useful data available to divelog software). Because of the differences in used algorithms and amount of data available (and taken into consideration) at the time of the calculation it is unlikely that both of these are the same; this can be true even if the same algorithm and _gradient factors_(see below) are used. It is also quite common that _Subsurface_ calculates a ceiling for non-decompression dives when the dive computer stayed in non-deco mode during the whole dive (represented by the [green]#dark green# section in the profile at the beginning of this section). This is caused by the fact that _Subsurface_’s calculations describe the deco obligation at that point in time during a dive, while dive computers usually take the upcoming ascent into account. During the ascent some excess Nitrogen (and possibly Helium) are already breathed off so even though the diver technically encountered a ceiling at depth, the dive still does not require an explicit deco stop. This feature allows dive computers to offer longer non-stop bottom time.

For a more detailed explanation of _gradient factors_, use the following links:

- link:http://www.tek-dive.com/portal/upload/M-Values.pdf[Understanding M-values, by Erik Baker, 1988, _Immersed_ Vol. 3, No. 3.]

- link:http://www.rebreatherworld.com/general-and-new-to-rebreather-articles/5037-gradient-factors-for-dummies.html[Gradient factors for dummies, by Kevin Watts]


=== The *Information Box*

The Information box displays a large range of information pertaining to the dive profile. Normally the Information Box is located to the top left of the *Dive Profile* panel. If the mouse points outside of the *Dive Profile* panel, then only the top line of the Information Box is visible (see left-hand part of figure below). The Information Box can be moved around in the *Dive Profile* panel by click-dragging it with the mouse so that it is not obstructing important detail. The position of the Information Box is saved and used again during subsequent dive analyses.

image::images/InfoBox.png["Figure: Information Box",align="centre"]

The moment the mouse points inside the *Dive Profile* panel, it expands and shows many data items. In this situation, the data reflect the time point along the dive profile indicated by the mouse (see right-hand part of figure above where the Information Box reflects the situation at the position of the cursor [arrow] in that image). Therefore, moving the cursor in the horizontal direction allows the Information Box to show information for any point along the dive profile. In this mode, the Information Box gives extensive statistics about depth, gas and ceiling characteristics of the particular dive. These include: Time period into the dive (indicated by a @), depth, cylider pressure (P), temperature, ascent/descent rate, surface air consumption (SAC), oxygen partial pressure, maximum operating depth, effective air depth (EAD), effective nitrigen depth (END), equivalent air density depth (EADD), Decompression requirements at that instand in time (Deco), time to surface (TTS), the calculated ceiling, as well as the calculated ceiling for several Bühlmann tissue compartments.


== Organising the logbook (Manipulating groups of dives)

=== The context menu

Many actions within _Subsurface_ are dependent on a context menu that is used mostly to manipulate  groups of dives. The context menu is found by selecting a dive or a group of dives and then right-clicking.

image::images/ContextMenu.png["Figure: Context Menu",align="left"]

The context menu is used in many manipulations described below.


=== Renumbering the dives

Dives are normally numbered incrementally from non-recent dives (low sequence numbers) to recent dives (having the highest sequence numbers). The numbering of the dives is not always consistent. For instance, when non-recent dives are added to the dive list the numbering does not automatically follow on because of the dives that are more recent in date/time than the newly-added dive that has an older date/time. Therefore one sometimes needs to renumber the dives. This is performed by selecting (from the Main menu) Log -> Renumber. You are given a choice with respect to the lowest sequence number to be used. Completing this operation results in new sequence numbers (based on date/time) for the dives in the *Dive List* panel.

=== Grouping dives into trips and manipulating trips

If one dives regularly, the dive list can rapidly become very long. _Subsurface_ can group dives into _trips_. It performs this by grouping dives that have date/times that are not separated in time by more than two days, thus creating a single heading for each diving trip represented in the dive log. Below is an ungrouped dive list (on the left) as well as a grouped dive list with several trips (on the right):

image::images/Group2.png["Figure: Grouping dives",align="center"]

Grouping into trips allows a rapid way of accessing individual dives without having to scan long lists of dives. In order to group the dives in a dive list, (from the Main Menu) select Log -> Autogroup. The *Dive List* panel now shows only the titles for the trips.

==== Viewing the dives during a particular trip
Once when the dives have been grouped into trips, one can expand one or more trips by clicking the arrow-head on the left of each trip title. This expands the selected trip, revealing the individual dives performed during the trip.

==== Editing the title and associated information for a particular trip

Normally, in the dive list, minimal information is included in the trip title. One can add much more information about a trip by selecting its trip title from the dive list. This shows a *Trip Notes* tab in the *Dive Notes* panel. Here you can add or edit information about the date/time, the trip location and any other general comment about the trip as a whole (e.g. the dive company you dived with, the general weather during the trip). After entering this information, select *Save* from the buttons at the bottom right of the *Trip Notes* tab. The trip title in the *Dive List* panel should now reflect some of the edited information.

==== Collapsing or expanding dive information for different trips

If one right-clicks after selecting a particular trip in the dive list, the resulting context menu allows several possibilities to expand or collapse dives within trips. This includes expanding all trips, collapsing all trips and collapsing all trips except the selected one.

==== Merging dives from more than one trip into a single trip

When one right-clicks on a selected trip title in the *Dive List* panel, the context menu allows the merging of trips by either merging of the selected trip with the trip below or with the trip above.

==== Splitting a single trip into more than one trip

If a trip includes five dives, one can split this trip into two trips (trip 1: top 3 dives; trip 2: bottom 2 dives) by selecting and right-clicking the top three dives. The resulting context menu allows one create a new trip by choosing the option *Create new trip above*. The top three dives are then grouped into a separate trip. See below, the selection and context menu on the left, the completed action on the right:

image::images/SplitDive3a.png["Example: Split a trip into 2 trips",align="center"]

== Manipulating single dives

=== Delete a dive from the dive log

Dives can be permanently deleted from the dive log by selecting and right-clicking them to bring up the context menu, and then selecting *Delete dive*. Typically this would apply to a case where one wishes to delete workshop calibration dives of the dive computer or dives of extremely short duration.

=== Unlink a dive from a trip

One can unlink dives from the trip to which they belong. Select and right-click the dives to bring up the context menu. Then select *Remove dive(s) from trip*. The dives that have been unlinked now appear immediately above the trip to which they belonged.

=== Add a dive to the trip immediately above

Selected dives can be moved from the trip to which they belong and placed within the trip immediately above the currently active trip. Select and right-click the dives to bring up the context menu, then select *Add dive(s) to trip immediately above*.

=== Shift the start time of dive(s)

Sometimes it is necessary to adjust the start time of a dive. This may apply to situations where dives are performed in different time zones or when the dive computer has an erroneous time. Select and right-click the dive(s) to be adjusted. This brings up the context menu. Select *Shift times*. Specify the time (in hours and minutes) by which the dives should be adjusted and click on the option indicating whether the time adjustment should be forwards or backwards.

=== Merge dives into a single dive

Sometimes a dive is briefly interrupted, e.g. if a diver returns to the surface for a few minutes, resulting in two or more dives being recorded by the dive computer and appearing as different dives in the *Dive List* panel. One can merge these dives onto a single dive by selecting the appropriate dives and right-clicking them to bring up the context menu. Then select *Merge selected dives*. It may be necessary to edit the dive information in the *Dive Notes* panel to reflect events or conditions that apply to the merged dive. The figure below shows the depth profile two such dives that were merged:

image::images/MergedDive.png["Example: Merged dive",align="center"]

== Exporting the dive log or parts of the dive log

A dive log can be saved in two formats:

* _Subsurface_ XML format. This is the native format used by _Subsurface_.

* Universal Dive Data format (UDDF). See http://uddf.org for more information. UDDF is a generic format that enables communication among many dive computers and computer programs.

In order to save the WHOLE dive log (i.e. all trips and dives), select *File* from the Main menu. To save in _Subsurface_ XML format, select _File -> Save as_. To save in UDDF format, select _File -> Export UDDF_.

In order to save only one or more dives or one or two trips, select the appropriate dives or trips in the *Dive List* panel. Then right-click the selected dives to bring up the context menu. To save in _Subsurface_ XML format, select _Save as_ from the context menu. To save in UDDF format, select _Export as UDDF_ from the context menu.


== Setting your *Preferences* for _Subsurface_

There are several settings within _Subsurface_ that the user can specify. These are found when selecting _File->Preferences_. The settings are performed in three groups: *Defaults*, *Units* and *Graph*. All three sections operate on the same principles: specify the settings you wish to change, then save these using the *Apply* button. After applying the new settings one can leave the settings panel by selecting *OK*.

=== Defaults

There are four settings in the *Defaults* panel:

  ** *Lists and tables*: Here one can specify the font type and font size of the Dive Table panel. By decreasing the font size of the Dive table,
one can see more dives on a screen.

  ** *Dives*: Here one needs to specify the directory and file name of your electronic dive log book. This is a file with filename extension .xml. _Subsurface_ will then automatically load the dive log book specified.

  ** *Display invalid*:  Dives can be marked as invalid (when you want to hide dives that you don't consider valid dives, e.g. pool dives, but still want to keep them in the dive log). This controls whether those dives are displayed in the dive list.

  ** *Use Default cylinder*: Here one can specify the default cylinder listed in the *Equipment* tab of the *Dive Notes* panel.

=== Units
Here one can choose between metric and imperial measures of depth, pressure, volume, temperature and mass. By selecting the Metric or Imperial radio button at the top, one can specify that all units are in the chosen measurement system. Alternatively, if one selects the *Personalise* radio button, one can select a mixture with some measurements being metric while others are in imperial measures.

=== Graph
This panel allows two type of selections:

* *Show*: Here one specifies the amount of information that is shown as part of the dive profile:
** Gas pressure graphs: _Subsurface_ can display the pressures of the gases with which you dive. If you dive breathing air, then the only important gas is nitrogen. You can instruct _Subsurface_ to plot the nitrogen pressure during your dive. If you dive breathing nitrox, then you can select a graph of both the nitrogen and oxygen pressures during your dive. If you dive with trimix or heliox, you can select the display of the helium pressure as well. For each of these graphs you can specify a threshold value on the right-hand side of the panel. If any of the graphs go above this threshold level, the graph is highlighted in red, indication that the threshold value has been exceeded (see figure below).

** Ceiling: Ascent ceilings arise when a direct ascent to the surface exposes the diver to decompression sickness (DCS) and it is necessary to either ascend slower or to perform decompression stop(s) before ascending to the surface. _Subsurface_ can indicate these ceilings above which the diver should not ascend at a particular point in time (see the green-shaded areas in the figure in the section on <<S_DiveProfile,Dive Profiles>>) and in the figure below:

*** If one checks *Calculated ceiling*, then a ceiling is shown if it exists for a particular dive (*A* in figure below)

*** If one checks *show all tissues*, the ceiling is shown for the tissue compartments following the Bühlmann model (*B* in figure below).

*** If one checks *3m increments*, then the ceiling is indicated in 3m-increments (*C* in figure below).

*** If the dive computer itself calculates a ceiling and makes it available to _Subsurface_ during upload of dives, this can be
shown by checking *Dive computer reported ceiling* and it can be drawn in red by checking *Draw ceiling red*.

** If a _Maximum operating depth (MOD)_ or an _Effective air depth (EAD)_ applies to a dive profile, these can be shown by checking the appropriate boxes.

** If a _Maximum partial pressure of oxygen (maxPPO2)_ applies to dives, then this can be specifies in the appropriate text box. In addition, if a _no-decompression limit(NDL)_ is to be shown in the *info* box, then check the appropriate box.

image::images/Ceilings.png["Figure: Ceiling with 3m resolution",align="center"]

* *Misc*: Here one can set the _gradient factors_ used while diving. GF_Low is the gradient factor at deep depths and GF_High is used just below the surface. At intermediate depths gradient factor between GF_Low and GF_High are used. Gradient factors add conservatism to the nitrogen exposure during a dive, in a similar way that many dive computers have a conservatism setting. The lower the value of a gradient factor, the more conservative the calculations are with respect to nitrogen loading and the lower the ascent ceilings are. Gradient factors of 25/60 are considered conservative and values of 60/90 are considered harsh. Checking *GFLow at max depth* box causes GF_Low to be used at the deepest depth of a dive. For more information see:

  ** http://www.tek-dive.com/portal/upload/M-Values.pdf[Understanding M-values by Erik Baker, , _Immersed_ Vol. 3, No. 3.]

[NOTE]
+Important concept.+
There are opposite definitions for _EAD_ and _END_ depending on people and even organisations. Subsurface has choosen that *_EAD_ means Equivalent Air Depth considering both oxygen and nitrogen narcotics*, while *_END_ would mean Equivalent Nitrogen Depth (ignoring oxygen)*. This way, _EAD_ would be a measure for the narcotic potential of a gas, while _END_ would be more related to nitrogen absortion by tissues. So, when diving NITROX, _EAD_ will remain the same (or almost) than real depth, while _END_ would be the interesting depth for deco calculations.

[[S_Companion]]
== Importing GPS coordinates with Subsurface companion.
If you have an Android device with GPS, you can achieve the coordinates of the point where you are diving and automatically pass them to your Subsurface divelog. You only need:

- [red]#Register in Subsurface companion page.# http://api.hohndel.org/login/ You'll receive a confirmation mail with instructions and your *DIVERID*, this id will give you access to the companion app capabilities.

- [red]#Download the app.# You can download it from https://play.google.com/store/apps/details?id=org.subsurface or http://f-droid.org/repository/browse/?fdfilter=subsurface&fdid=org.subsurface .

=== Using Subsurface companion app.

On first use the app has three options:

* +Create a new account.+  Equivalent to register in Subsurface companion page.

* +Retrieve an account.+  This is the option you would use if someway have forgot your DIVERID. You should receive an email whith it.

* +Use an existing account.+ You'll be prompted to introduce your DIVERID.

The app stores your ID and don't ask for it again unless you use the _Disconnect_ menu option commented below.

Now you're ready to get a dive position and send it to the server.  The android display will look like next image, but without any dive.

image::images/companion_1.png["Entry display for companion app",align="center"]

Typing the "+" icon on the right you will be prompted for a name for the dive point (or asked first for the GPS activation if this was turned off), and you will get a register in the display with the name of the dive point, date and time.   As you can see in the image above, there are two kind of register, those with a little arrow up and those without it.  The arrow up means the dive is stored in the device, but hasn't been sent to the server.

Now we want to send the dive to the server. There are several ways of doing this. Easiest is simply selecting the dive as seen in this image

image::images/companion_2.png["Selecting dive points",align="center"]

and typing the right arrow will send it to the server.  Be careful, the trash on the right means exactly what it's supossed to mean, it would delete de dive point.

Well, the new dive point is stored in the server and can be downloaded to Subsurface divinglog whenever you register your dive in it.  If returning from a dive trip, and you have been lucky, there can be lots of dive points coordinates ready to be saved on your divelog.  We will see how to do this later.

Next step would be adjust your preferences in the _Settings_ menu option.  Let's see the options we would get by opening the menu.

image::images/companion_3.png["Menu options displayed",align="center"]


==== Settings

===== Server and account

- +Web-service URL.+ Predefined. It's actually http://api.hohndel.org/

- +User ID.+ Obtained by registering as indicated above. The easiest way to introduce it is simply copy+paste from the confirmation mail but, off course, you can type it char by char.

===== Synchronization

- +Synchronize on startup.+ If selected, dives in android device and those on the web service will synchronize each time you start the app.

- +Upload new dives.+ If selected, each time you add a dive it'll automatically be sent to the server.

===== Background service
Instead of take a unique position, you can leave the service running on background on your device. This setting will define the behaviour of the service.

- +Min duration.+ In minutes. The app'll try to get a position each X minutes until you stop it.

- +Min distance.+ In meters. Minimum distance between two position fixes.

- +Name template.+ Te name the app'll use when saving the position fixes.

[NOTE]
_How background service works?_ Let's asume we've set 5 minutes and 50 meters in the parameters above, the app will fix a position, then another one each 5 minutes. If this 2nd (3rd, 4th ...) is in a radius of 50 meters from the previous one, the position won't be saved. After another 5 minutes there will be a new try, and so on.  This way, if we are in a static position, we'll only get a fix, but if we're moving we can have a nice trace of our journey.

===== Other

- +Mailing List.+ The mail box for Subsurface. You can send an email to the subsurface mailing list.

- +Subsurface website.+ A link to the URL of Subsurface web

- +Version.+ Displays the current version of the companion app.

==== Search

Here you can search your saved dive points by the name you gave them or by date and hour.

==== Start service

Initiates the _background service_. It'll work depending on the previously fixed settings.

==== Disconnect

Badly named option. It disconnects your app from the server by resetting your ID in the app. It will send you to the first display where you can create an account, retrieve the ID for an existing one or use your own ID. Useful if you are downloading the dive positions for another registered user with your android device.

==== Send all locations

As expected, this option will send all locations stored in the android device to the server.

=== Downloading dive locations to your Subsurface divelog

First you will have downloaded your dive/s from your DC or created them manually.  Now you want to get the GPS coordinates from the server. The download dialog can be reached via _Ctrl+G_ or from Subsurface's main menu _Import -> Import GPS data from Subsurface Service_

image::images/Downloading_GPS.png["Initial downloading GPS dialog ",align="center"]

On first use the DIVERID will be blanked, so you'll have to put it here as usual.  Then simply clik on the _Download_ button and the download begins.  When ended you'll get the next

image::images/Downloading_GPS_2.png["After downloading",align="center"]

Note the _Apply_ button now active, click on it and, luckily, you'll be done.  Subsurface's logic should apply the coordinates and names you gave them for all the new dives.

[NOTE]
_Features, issues and tips._  Automatically applying of GPS data to the dives is a task very dependent on a correct time.  Note that there might be a difference between time in your DC and time in your android device, if you have a little one there'll be no problem and the logic will work fine, but if it's big Subsurface will be unable to identify the dive which matches the coordinates, and nothing will happen. The ideal is have a correct time in your DC (or in the android device, whichever is wrong)  but this may be not possible.  A dirty hack is editing manually the time in Subsurface's log _before_ downloading the GPS data. If the correct time was the erased one, then simply edit it back manually again _after_ downloading.


== APPENDIX A: Operating system specific information for importing dive information from a dive computer.

=== Make sure that your OS has the required drivers installed
[icon="images/icons/drivers.jpg"]
[NOTE]
The operating system of your desktop computer needs the appropriate drivers in order to
communicate with your dive computer in whichever way your dive computer prefers (e.g. bluetooth, USB, infra-red).

	* On Linux this means you need to have the correct kernel
	  module loaded. Most distributions will do this automatically
	  for you. Make sure you have read/write permissions to that
	  port. On Ubuntu that could mean you should run the command
	  following command in a terminal window:

	+sudo adduser+ [your_username] +dialout+

	* On Windows, the OS should offer to download the correct
	  driver once you connect your dive computer to the USB port.

	* On a Mac you at times have to manually hunt for the correct
	  driver. For example the correct driver for the Mares Puck
	  devices can be found as Mac_OSX_VCP_Driver.zip at
	  http://www.silabs.com/support/pages/support.aspx?ProductFamily=USB+Bridges
	  [red]#(see further hints in <<AppendixB,Appendix B>>)#

[[S_HowFindDeviceName]]
=== How to Find the Device Name for USB devices
[icon="images/icons/usb.jpg"]
[NOTE]
When you connect your dive computer by using an USB connector, usually
Subsurface will either propose a drop down list that contains the
correct device name (or mount point for the Uemis Zurich), or it will
disable the device select drop down if no device name is needed at
all. In the rare cases where this doesn't work here are some
instructions on ways to find out what your device name is:

.On Windows:

Simply try COM1, COM2, etc. The drop down list should contain all connected COM devices.

.On MacOS:

The drop down box should find all connected dive computers.

.On Linux:

Try the following:

 - Disconnect your USB cable of your dive computer
 - Open a terminal
 - Type the command: 'dmesg' and press enter
 - Plug in your USB cable of your dive computer
 - Type the command: 'dmesg' and press enter

Within your terminal you should see a message similar to this one:

	usb 2-1.1: new full speed USB device number 14 using ehci_hcd
	usbcore: registered new interface driver usbserial
	USB Serial support registered for generic
	usbcore: registered new interface driver usbserial_generic
	usbserial: USB Serial Driver core
	USB Serial support registered for FTDI USB Serial Device
	ftdi_sio 2-1.1:1.0: FTDI USB Serial Device converter detected
	usb 2-1.1: Detected FT232BM
	usb 2-1.1: Number of endpoints 2
	usb 2-1.1: Endpoint 1 MaxPacketSize 64
	usb 2-1.1: Endpoint 2 MaxPacketSize 64
	usb 2-1.1: Setting MaxPacketSize 64
	usb 2-1.1: FTDI USB Serial Device converter now attached to ttyUSB3
	usbcore: registered new interface driver ftdi_sio
	ftdi_sio: v1.6.0:USB FTDI Serial Converters Driver

You see that in the third line from the bottom, the USB adapter is
detected and is connected to +ttyUSB3+. Now you use this information in
the import settings as +/dev/ttyUSB3+. Your dive computer interface is
connected and you should be able to import your dives.

[[S_HowFindBluetoothDeviceName]]
=== Setting up bluetooth enabled devices
[icon="images/icons/bluetooth.jpg"]
[NOTE]
For dive computers communicating through bluetooth like the Heinrichs
Weikamp Frog or the Shearwater Predator and Petrel there is a
different procedure to get the devices name to communicate with
subsurface. In general it consists of these steps:

 * enable bluetooth on your computer
 * pairing the device

Please do not forget to set your divecomputer in Bluetooth or upload mode before
Paring and Downloading logs. If you use a Shearwater Predator/Petrel just select
_Dive Log -> Upload Log_ and wait until you see the _Wait PC_ message.

.On Windows:

Bluetooth is most likely already enabled. For pairing the device choose
Control Panel->Bluetooth Devices->Add Wireless Device
This should bring up a dialog showing your dive computer (in Bluetooth mode) and
allowing to pair it. For bluetooth pairing of your dive computer refer to the manufacturer's user guide. The dive
computer should then show up in the list of Bluetooth devices and you may then
right click on it and choose Properties->COM Ports to get known of the ports
used for your dive computer. If there are several ports listed, use the one
saying "Outgoing" instead of "Incoming".

For downloading to _Subsurface_, the drop down list should contain this COM
port already, if not enter it manually.

Note: If you have issues downloading from your dive computer in other software
afterwards try to remove the pairing with your dive computer.

.On MacOS:

Click on the Bluetooth symbol in the menu bar and select 'Set up
Bluetooth Device...'. Make sure that your dive computer is in upload
mode; it should then show up in the list of devices. Select it and go
through the pairing process. This step should only be needed once for
initial setup.

Once the pairing is completed the correct device will be shown in the
'Device or Mount Point' drop down in the _Subsurface_ *Import* dialog.

.On Linux
Ensure sure bluetooth is enabled on the _Subsurface_ computer.
On most common distributions this should be true out of the box. If not then
depending on your system, running +initd+ or +systemd+ this might be different and
also involve loading modules specific to your hardware. In case your system is
running +systemd+ manually run +sudo systemctl start bluetooth.service+ to enable
it, in case of +initd+ run something like +sudo rc.config start bluetoothd+ or
+sudo /etc/init.d/buetooth start+.

Pairing should be straight forward. Using Gnome3 for instance will show a
bluetooth icon in the upper right corner of your desktop where you select 'Set
up New Device'. This should show you a dialog where you are able to select your
dive computer (in bluetooth mode) and pair it. If you have issues with PIN
setting try manually setting '0000'.

You may also use a manual approach by using such commands:

 * +sudo hciconfig+ - shows the bluetooth devices available on your
computer (not dive computer), most likely you will see a hci0, if not
try 'sudo hcitool -a' to see inactive devices and try to run 'sudo
hciconfig hci0 up' to bring them up

 * +sudo hcitool scanning+- use this to get a list of bluetooth enabled
client devices, watch out for your dive computer and remember the MAC
address shown there

 * +sudo bluez-simple-agent hci0 10:00:E8:C4:BE:C4+ - this will pair
your dive computer with the bluetooth stack of your computer, copy/paste
the MAC address from the output of 'hcitool scanning'

Unfortunately on Linux binding to a communication device has to be done
manually by running:

 * +sudo rfcomm bind /dev/rfcomm0 10:00:E8:C4:BE:C4+ - bind the dive
computer to a communication device in your computer, in case rfcomm is
already taken just use rfcomm1 or up, please copy/paste the MAC address
from the output of 'hcitool scanning', the MAC shown in here will not
work for you.

For downloading dives in Subsurface you have then to specify +/dev/rfcomm0+
as device name to use.


== APPENDIX B: Dive Computer specific information for importing dive information.


[[S_ImportUemis]]
=== Import from a Uemis Zurich

[icon="images/icons/iumis.jpg"]
[NOTE]
Things are very similar when downloading dives from a Uemis Zurich
dive computer (which certainly is one of the ones that DO recharge when
connected to the USB port). The main difference is that you don't enter a
device name, but instead the location where the UEMISSDA file system is
mounted once you connect the dive computer. On Windows this is a drive letter (often 'E:' or 'F:'), on a Mac this is
'/Volumes/UEMISSDA' and on Linux systems this differs depending on the
distribution that you use. On Fedora it usually is
'/var/run/media/<your_username>/UEMISSDA'. In all cases Subsurface
should suggest the correct location in the drop down list.

Once you have selected this as device name you can download the
dives from the Uemis Zurich. One technical issue with the Uemis Zurich
download implementation (this is a firmware limitation, not a
Subsurface issue) is that you cannot download more than about 40-50
dives without running out of memory on the SDA. This will usually only
happen the very first time you download dives from the Uemis Zurich -
normally when downloading at the end of a day or even after a dive
trip, the capacity is sufficient. If Subsurface displays and error
that the dive computer ran out of space the solution is straight
forward.  Disconnect the SDA, turn it off and on again, and reconnect
it. You can now retry (or start a new download session) and the
download will continue where it stopped the last time you tried. You
may have to do this more than once, depending on how many dives you
have stored on your dive computer.

At this point Subsurface downloads most of the information that is
stored on the SDA, including information about dive spots and
equipment. Buddy information is not yet downloaded.

=== Import from Shearwater Predator using bluetooth

[icon="images/icons/predator.jpg"]
[NOTE]
Using a Shearwater Predator you may be able to pair but then encounter issues when
downloading, showing errors like _Slip RX: unexp. SLIP END_ on the Predator.
This might also be seen, when using other dive log software and operating
systems than Linux. We have no detailed idea about the source and how to fix
this, but it is reported to be solved sometimes by one of these steps:

 * use the bluetooth dongle which came with the Shearwater Predator instead of
   the built-in one of your computer
 * switch to different bluetooth drivers for your hardware
 * switch off WiFi while using Bluetooth


== APPENDIX C: Important Sections that need writing, revision and editing:

Please add any topics you think are important:

* The Main Menu items need to be covered systematically, providing in-document links where appropriate:

* Importing GPS positions from Subsurface mobile API

* Importing/exporting to divelogs.de

* Importing data from other electronic resources - Present information comes from Subsurface 3.1.1 manual. How much of it is still valid? Needs to be verified.

* Importing data from dive computers - Appendices A and B come mainly from Subsurface 3.1.1 manual. How much of it is still valid? Needs to be verified. Difficult work, but **critical** for the success of Subsurface.
